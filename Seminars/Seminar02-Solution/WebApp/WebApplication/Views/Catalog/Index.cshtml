@using PV293WebApplication.Models
@model CatalogPageViewModel
@{
    Layout = "_Layout";
    var f = Model.Filter;
    ViewData["Title"] = "Catalog";
}

<div class="container">
    <h1 class="h3 mb-3">Catalog</h1>

    <form method="get" asp-action="Index" class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="row g-3 align-items-end">
                <div class="col-12 col-md-4">
                    <label for="Search" class="form-label">Search</label>
                    <input id="Search" name="Search" class="form-control" type="text"
                           value="@f.Search" placeholder="Search products..." />
                </div>

                <div class="col-12 col-md-4">
                    <label for="CategoryId" class="form-label">Category</label>
                    <select id="CategoryId" name="CategoryId" asp-items="Model.Categories" class="form-select">
                        <option value="">All categories</option>
                    </select>
                </div>

                <div class="col-12 col-md-2">
                    <label for="Sort" class="form-label">Sort by</label>
                    <select id="Sort" name="Sort" class="form-select">
                        <option value="name_asc"  selected="@(f.Sort == "name_asc")">Name ↑</option>
                        <option value="name_desc" selected="@(f.Sort == "name_desc")">Name ↓</option>
                        <option value="price_asc" selected="@(f.Sort == "price_asc")">Price ↑</option>
                        <option value="price_desc"selected="@(f.Sort == "price_desc")">Price ↓</option>
                    </select>
                </div>

                <div class="col-6 col-md-1">
                    <label for="PageSize" class="form-label">Size</label>
                    <select id="PageSize" name="PageSize" class="form-select">
                        <option value="8"  selected="@(f.PageSize == 8)">8</option>
                        <option value="12" selected="@(f.PageSize == 12)">12</option>
                        <option value="24" selected="@(f.PageSize == 24)">24</option>
                        <option value="48" selected="@(f.PageSize == 48)">48</option>
                    </select>
                </div>

                <div class="col-6 col-md-1 d-grid">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-funnel"></i> Apply
                    </button>
                </div>
            </div>
        </div>
    </form>

    @if (!Model.Results.Items.Any())
    {
        <div class="alert alert-info d-flex align-items-center" role="alert">
            <i class="bi bi-search me-2"></i>
            <div>No products found. Try changing your filters.</div>
        </div>
    }
    else
    {
        <div class="row g-3">
            @foreach (var p in Model.Results.Items)
            {
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="card h-100 shadow-sm">
                        <div class="ratio ratio-1x1 bg-light d-flex align-items-center justify-content-center">
                            <span class="text-muted small">No image</span>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h3 class="h6 card-title mb-1">
                                <a class="text-decoration-none"
                                   asp-controller="Product" asp-action="Details" asp-route-id="@p.Id">
                                    @p.Name
                                </a>
                            </h3>
                            <div class="text-muted small mb-2">
                                @(p.Category?.Name ?? "Uncategorized")
                            </div>
                            <div class="fw-semibold mb-2">@p.Price.ToString("C")</div>

                            @if (!string.IsNullOrEmpty(p.Description))
                            {
                                <p class="card-text small text-muted mb-3">@p.Description</p>
                            }

                            <div class="mt-auto d-flex gap-2">
                                <a class="btn btn-sm btn-outline-secondary flex-fill"
                                   asp-controller="Product" asp-action="Details" asp-route-id="@p.Id">
                                    Details
                                </a>
                                <form class="flex-fill" asp-controller="Cart" asp-action="Add" method="post">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@p.Id" />
                                    <input type="hidden" name="qty" value="1" />
                                    <button type="submit" class="btn btn-sm btn-primary w-100">
                                        <i class="bi bi-bag-plus"></i> Add
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>

        <nav aria-label="Catalog pages" class="mt-4">
            <ul class="pagination justify-content-center flex-wrap">
                <li class="page-item @(Model.Results.HasPrev ? "" : "disabled")">
                    <a class="page-link"
                       asp-action="Index"
                       asp-route-Search="@f.Search"
                       asp-route-CategoryId="@f.CategoryId"
                       asp-route-Sort="@f.Sort"
                       asp-route-Page="@(Model.Results.Page - 1)"
                       asp-route-PageSize="@f.PageSize"
                       tabindex="@(Model.Results.HasPrev ? "0" : "-1")">Previous</a>
                </li>

                @for (int pageNumber = 1; pageNumber <= Model.Results.TotalPages; pageNumber++)
                {
                    <li class="page-item @(pageNumber == Model.Results.Page ? "active" : "")">
                        <a class="page-link"
                           asp-action="Index"
                           asp-route-Search="@f.Search"
                           asp-route-CategoryId="@f.CategoryId"
                           asp-route-Sort="@f.Sort"
                           asp-route-Page="@pageNumber"
                           asp-route-PageSize="@f.PageSize">@pageNumber</a>
                    </li>
                }

                <li class="page-item @(Model.Results.HasNext ? "" : "disabled")">
                    <a class="page-link"
                       asp-action="Index"
                       asp-route-Search="@f.Search"
                       asp-route-CategoryId="@f.CategoryId"
                       asp-route-Sort="@f.Sort"
                       asp-route-Page="@(Model.Results.Page + 1)"
                       asp-route-PageSize="@f.PageSize"
                       tabindex="@(Model.Results.HasNext ? "0" : "-1")">Next</a>
                </li>
            </ul>
        </nav>
    }
</div>
